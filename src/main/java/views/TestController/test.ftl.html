<#import "../layout/defaultLayout.ftl.html" as layout>
<@layout.myLayout "Interswitch">

<div class="container mt-5 mb-5 card col-md-10">
    <form class="row m-5" action="" method="post">
    <#--<#if (flash.error)??>-->
    <#--<div class="alert alert-danger">-->
    <#--${flash.error}-->
    <#--</div>-->
    <#--</#if>-->
    <#--<#if (flash.success)??>-->
    <#--<div class="alert alert-success">-->
    <#--${flash.success}-->
    <#--</div>-->
    <#--</#if>-->
        <div class="form-group col-md-5">
            <label>Merchant reference</label>
            <input type="text" class="form-control" id="merchRef"
                   placeholder="Enter merchant reference" name="merchRef" required>
        </div>
        <div class="form-group col-md-5">
            <label>Customer reference</label>
            <input type="text" class="form-control" id="custRef"
                   placeholder="Enter customer reference" name="custRef" required>
            <input type="hidden" class="form-control" name="type" value="ar" required>
        </div>
        <div class="form-group col-md-2" style="margin-top: 28px">
            <button type="button" class="btn  btn-outline-success  col-12" id="validate"> Validate</button>
        </div>
    </form>
    <div class="row  m-5">
        <div class=" col-12">
            <div id="validating" class="progress">
                <div class="progress-bar progress-bar-striped  bg-success progress-bar-animated" role="progressbar"
                     aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">

                </div>
            </div>
        </div>
        <table class="table table-striped table-bordered col-12" style="width: 100%">
            <tr>
                <th style="width: 30%;">Customer reference</th>
                <td>${custRef!"N/A"}</td>
            </tr>
            <tr>
                <th style="width: 30%;">Customer name</th>
                <td>N/A</td>
            </tr>
            <tr>
                <th style="width: 30%;">Amount (&#8358;)</th>
                <td>N/A</td>
            </tr>
        </table>
    </div>
    <hr>
    <form class="row m-5" id="assForm" action="" method="post">
        <div class="form-group col-md-6">
            <label>Item Code</label>
            <input type="text" class="form-control" id="itemCode" value="${(itemCode)!""}"
                   placeholder="Enter payment Item Code" name="itemCode" required>
        </div>
        <div class="form-group col-md-6">
            <label>Payment Provider Reference</label>
            <input type="text" class="form-control" id="ppr" value="${(ppr)!""}"
                   placeholder="Enter payment provider reference" name="ppr">
        </div>
        <div class="form-group col-md-6">
            <label for="exampleInputAmount">Amount to pay (&#8358;)</label>
            <input type="text" class="form-control" id="amount"
                   pattern="[0-9]+\.?[0-9]+"
                   placeholder="Enter amount" name="amount" required>
        </div>
        <div class="form-group col-md-6">
            <label for="exampleInput">Invalid CustRef?<span
                    class="text-danger">*</span></label>
            <select class="form-control" id="exampleInput" name="noCR" required>
                <option value="false">NO</option>
                <option value="true">YES</option>
            </select>
        </div>
        <div class="form-group col-md-12" style="margin-top: 10px">
            <button class="btn btn-outline-success float-right"> Pay</button>
        </div>
    </form>
</div>
<script>
    $(document).ready(function () {
        $("#validating").hide();
        // $("#proceed").click(function () {
        //     var tid = $("#ref").val();
        //     $.ajax({
        //         url: "/interswitch?transactionId=" + tid + "&type=ar",
        //         type: "GET",
        //         dataType: "json",
        //         success: function (data) {
        //             console.log(data);
        //         },
        //         error: function (xhr, status) {
        //             alert("Sorry, there was a problem!");
        //         },
        //         complete: function (xhr, status) {
        //             //$('#showresults').slideDown('slow')
        //         }
        //     });
        // });
        $("#validate").click(function () {
            $("#validating").show();
            var custRef = $("#custRef").val();
            var merchRef = $("#merchRef").val();
            $.ajax({
                url: "/api/paydirect/validate?custRef=" + custRef + "&merchRef=" + merchRef,
                type: "POST",
                dataType: "json",
                contentType: "application/x-www-form-urlencoded",
                success: function (data) {
                    console.log(data);
                    console.log(data.customers.customers[0]);
                    $("#validating").hide();
                },
                error: function (xhr, status) {
                    alert("Sorry, there was a problem!");
                    $("#validating").hide();
                },
                complete: function (xhr, status) {
                    //$('#showresults').slideDown('slow')
                }
            });
        })
    });
</script>
</@layout.myLayout>